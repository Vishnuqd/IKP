{% extends "base.html" %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{% url 'faculty_dashboard' %}">Dashboard</a></li>
    <li class="breadcrumb-item active" aria-current="page">Upload Question Paper</li>
  </ol>
</nav>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white text-center">
                    <h4>Upload Question Paper</h4>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="id_name" class="form-label fw-bold">Paper Name</label>
                            <input type="text" name="name" id="id_name" class="form-control" placeholder="Enter paper name" required>
                        </div>

                        <div class="mb-3">
                            <label for="id_description" class="form-label fw-bold">Description</label>
                            <textarea name="description" id="id_description" class="form-control" rows="3" placeholder="Brief description of the question paper"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="id_semester" class="form-label fw-bold">Semester</label>
                            <select name="semester" id="id_semester" class="form-select" required>
                                {% for semester in form.semester.field.queryset %}
                                    <option value="{{ semester.id }}">{{ semester.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="id_subject" class="form-label fw-bold">Subject</label>
                            <select name="subject" id="id_subject" class="form-select" required>
                                <option value="">Select Subject</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="id_exam_year" class="form-label fw-bold">Exam Year</label>
                            <input type="number" name="exam_year" id="id_exam_year" class="form-control" placeholder="Enter exam year" required>
                        </div>

                        <div class="mb-3">
                            <label for="id_file" class="form-label fw-bold">Upload Question Paper</label>
                            <input type="file" name="file" id="id_file" class="form-control" required>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Upload Paper</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log("JavaScript loaded");

        // Handle the change event for the Semester dropdown
        document.getElementById('id_semester').addEventListener('change', function() {
            var semesterId = this.value;  // Get selected semester id
            var subjectDropdown = document.getElementById('id_subject');  // Get subject dropdown

            // Clear existing options in subject dropdown
            subjectDropdown.innerHTML = '<option value="">Select Subject</option>';

            if (semesterId) {
                console.log("Fetching subjects for semester ID: " + semesterId);  // Check if the correct semester ID is passed

                // Fetch subjects based on selected semester using the correct URL
                fetch("/projects/get_subjects/?semester_id=" + semesterId)
                    .then(response => response.json())
                    .then(data => {
                        console.log("Received subjects:", data);  // Log the subjects data

                        // Populate subject dropdown with the fetched subjects
                        data.subjects.forEach(function(subject) {
                            var option = document.createElement('option');
                            option.value = subject.id;
                            option.text = subject.name;
                            subjectDropdown.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.log("Error fetching subjects:", error);  // Handle any errors
                    });
            }
        });
    });
</script>

{% endblock %}
